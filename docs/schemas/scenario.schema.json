{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Scenario Data",
    "type": "object",
    "required": [
        "scenarioId",
        "scenes"
    ],
    "properties": {
        "scenarioId": {
            "type": "string",
            "description": "Unique identifier for the scenario"
        },
        "scenes": {
            "type": "object",
            "additionalProperties": {
                "type": "array",
                "items": {
                    "$ref": "#/definitions/ScenarioCommand"
                }
            },
            "description": "Map of scene IDs to arrays of commands"
        }
    },
    "definitions": {
        "ScenarioCommand": {
            "type": "object",
            "discriminator": {
                "propertyName": "type"
            },
            "required": [
                "type"
            ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "text",
                        "show_card",
                        "hide_card",
                        "bg",
                        "choice",
                        "jump",
                        "battle",
                        "talk",
                        "event"
                    ]
                }
            },
            "oneOf": [
                {
                    "$ref": "#/definitions/CmdText"
                },
                {
                    "$ref": "#/definitions/CmdShowCard"
                },
                {
                    "$ref": "#/definitions/CmdHideCard"
                },
                {
                    "$ref": "#/definitions/CmdBg"
                },
                {
                    "$ref": "#/definitions/CmdChoice"
                },
                {
                    "$ref": "#/definitions/CmdJump"
                },
                {
                    "$ref": "#/definitions/CmdBattle"
                },
                {
                    "$ref": "#/definitions/CmdTalk"
                },
                {
                    "$ref": "#/definitions/CmdEvent"
                }
            ]
        },
        "CmdText": {
            "type": "object",
            "properties": {
                "type": {
                    "const": "text"
                },
                "speaker": {
                    "type": "string"
                },
                "content": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "speaker",
                "content"
            ]
        },
        "CmdShowCard": {
            "type": "object",
            "properties": {
                "type": {
                    "const": "show_card"
                },
                "cardId": {
                    "type": "string"
                },
                "position": {
                    "type": "string",
                    "enum": [
                        "left",
                        "center",
                        "right",
                        "right-top",
                        "right-bottom"
                    ]
                },
                "anim": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "cardId",
                "position"
            ]
        },
        "CmdHideCard": {
            "type": "object",
            "properties": {
                "type": {
                    "const": "hide_card"
                },
                "cardId": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "cardId"
            ]
        },
        "CmdBg": {
            "type": "object",
            "properties": {
                "type": {
                    "const": "bg"
                },
                "value": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "value"
            ]
        },
        "CmdChoice": {
            "type": "object",
            "properties": {
                "type": {
                    "const": "choice"
                },
                "options": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "label": {
                                "type": "string"
                            },
                            "nextScene": {
                                "type": "string"
                            },
                            "action": {
                                "type": "string"
                            }
                        },
                        "required": [
                            "label",
                            "nextScene"
                        ]
                    }
                }
            },
            "required": [
                "type",
                "options"
            ]
        },
        "CmdJump": {
            "type": "object",
            "properties": {
                "type": {
                    "const": "jump"
                },
                "nextScene": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "nextScene"
            ]
        },
        "CmdBattle": {
            "type": "object",
            "properties": {
                "type": {
                    "const": "battle"
                },
                "enemyId": {
                    "type": "string"
                },
                "nextScene": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "enemyId",
                "nextScene"
            ]
        },
        "CmdTalk": {
            "type": "object",
            "description": "TalkLayer形式の会話シーケンス",
            "properties": {
                "type": {
                    "const": "talk"
                },
                "dialogs": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/TalkDialog"
                    }
                },
                "nextScene": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "dialogs"
            ]
        },
        "CmdEvent": {
            "type": "object",
            "description": "イベントカード表示",
            "properties": {
                "type": {
                    "const": "event"
                },
                "eventType": {
                    "type": "string",
                    "enum": [
                        "battle",
                        "treasure",
                        "quest",
                        "info"
                    ]
                },
                "title": {
                    "type": "string"
                },
                "subtitle": {
                    "type": "string"
                },
                "icon": {
                    "type": "string"
                },
                "autoCloseDelay": {
                    "type": "number"
                }
            },
            "required": [
                "type",
                "eventType",
                "title"
            ]
        },
        "TalkDialog": {
            "type": "object",
            "description": "TalkLayer形式のダイアログ",
            "properties": {
                "id": {
                    "type": "string"
                },
                "speaker": {
                    "type": "string"
                },
                "speakerName": {
                    "type": "string"
                },
                "content": {
                    "type": "string"
                },
                "highlights": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "leftCard": {
                    "type": "string"
                },
                "rightTopCard": {
                    "type": "string"
                },
                "rightBottomCard": {
                    "type": "string"
                },
                "animation": {
                    "type": "string",
                    "enum": [
                        "enter",
                        "shake",
                        "fade"
                    ]
                },
                "choices": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/TalkChoice"
                    }
                }
            },
            "required": [
                "id",
                "speaker",
                "speakerName",
                "content"
            ]
        },
        "TalkChoice": {
            "type": "object",
            "description": "選択肢",
            "properties": {
                "id": {
                    "type": "string"
                },
                "label": {
                    "type": "string"
                },
                "nextDialogId": {
                    "type": "string"
                }
            },
            "required": [
                "id",
                "label"
            ]
        }
    }
}